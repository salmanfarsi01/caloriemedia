{% load static %}
<style>
    body { 
        background-color: #f0f4f8; 
        font-family: 'Poppins', sans-serif; 
        color: #2d3436; 
    }

    /* Navbar Styles */
    .navbar { background-color: #ffffff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

    /* Main Container - Adjusted to reduce gap */
    .auth-wrapper {
        min-height: 80vh; /* Reduced from 100vh to pull it up */
        padding-top: 30px; /* Small gap from header */
        display: flex;
        align-items: flex-start; /* Aligns to top, not center */
        justify-content: center;
    }

    .auth-card {
        background: #ffffff;
        width: 900px;
        max-width: 95%;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(50, 50, 93, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07);
        overflow: hidden;
        display: flex;
        min-height: 550px;
    }

    /* LEFT SIDE: Form */
    .auth-form-side {
        flex: 1;
        padding: 50px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    /* RIGHT SIDE: Image Updates */
    .auth-image-side {
        flex: 1;
        background-color: #e3fafc; /* Soft background color BEHIND the image */
        background-image: url('/media/hello.png'); 
        
        /* THIS MAKES IT SMALL & CENTERED */
        background-size: 60%;  /* Adjust this % to make it smaller/larger */
        background-repeat: no-repeat;
        background-position: center;
    }

    /* REMOVED the ::before overlay so opacity is 100% */

    /* Input Styling */
    .form-control-custom {
        width: 100%;
        padding: 12px 15px;
        margin-bottom: 20px;
        border: 1px solid #dfe6e9;
        background-color: #f8f9fa;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
    }
    .form-control-custom:focus {
        border-color: #6ab04c;
        background-color: #fff;
        box-shadow: 0 0 0 3px rgba(106, 176, 76, 0.1);
        outline: none;
    }
    .form-label { font-weight: 600; font-size: 0.85rem; color: #b2bec3; margin-bottom: 5px; display: block; }

    /* Form Submit Button */
    .btn-auth {
        background-color: #6ab04c;
        color: white;
        padding: 12px;
        border-radius: 30px;
        font-weight: 600;
        width: 100%;
        border: none;
        margin-top: 10px;
        cursor: pointer;
        transition: 0.3s;
    }
    .btn-auth:hover { background-color: #5da042; transform: translateY(-2px); }
    
    .auth-link { color: #6ab04c; text-decoration: none; font-weight: 600; }

    /* Header Buttons Styling */
    .btn-header-login {
        border: 1px solid #6ab04c;
        color: #6ab04c;
        border-radius: 20px;
        padding: 5px 20px;
        margin-right: 10px;
        text-decoration: none;
        font-weight: 600;
    }
    .btn-header-login:hover { background-color: #6ab04c; color: white; }

    .btn-header-signup {
        background-color: #6ab04c;
        color: white;
        border-radius: 20px;
        padding: 5px 20px;
        text-decoration: none;
        font-weight: 600;
        border: 1px solid #6ab04c;
    }
    .btn-header-signup:hover { background-color: #5da042; }

    /* Mobile */
    @media (max-width: 768px) {
        .auth-image-side { display: none; }
        .auth-card { flex-direction: column; height: auto; }
    }
</style>
<!DOCTYPE html>
<html>
<head>
    <title>CalorieMedia</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f4f8; color: #2d3436; font-family: 'Segoe UI', sans-serif; }
        .navbar { background-color: #ffffff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .btn-soft-green { background-color: #6ab04c; color: white; border: none; }
        .btn-soft-green:hover { background-color: #badc58; color: #2d3436; }
        .card { border: none; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); margin-bottom: 20px; }
        .ai-comment { background-color: #e3fafc; border-left: 4px solid #6ab04c; }
        .profile-img-sm { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
    </style>
</head>
<body>
    <!-- Inside templates/base.html -->
<nav class="navbar navbar-expand-lg navbar-light mb-4">
    <div class="container">
        <a class="navbar-brand fw-bold text-success" href="{% url 'home' %}">CalorieMedia ðŸ¥‘</a>
        
        <div class="ms-auto">
            {% if user.is_authenticated %}
                <a href="{% url 'home' %}" class="btn btn-sm btn-link text-decoration-none text-secondary">Feed</a>
                <a href="{% url 'profile' %}" class="btn btn-sm btn-link text-decoration-none text-secondary">Profile</a>
                <form action="{% url 'logout' %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-outline-danger">Logout</button>
                </form>
            {% else %}
                <!-- UPDATED BUTTONS HERE -->
                <a href="{% url 'login' %}" class="btn-header-login">Sign In</a>
                <a href="{% url 'register' %}" class="btn-header-signup">Sign Up</a>
            {% endif %}
        </div>
    </div>
</nav>

    <div class="container">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        {% block content %}{% endblock %}
    </div>
<!-- Floating Chat Button -->
<div id="chat-btn" onclick="toggleChat()" style="position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: #5da042; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 1000;">
    <span style="font-size: 30px;">ðŸ’¬</span>
</div>

<!-- Chat Window -->
<div id="chat-window" style="display: none; position: fixed; bottom: 100px; right: 30px; width: 300px; height: 400px; background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 1000; flex-direction: column;">
    <div style="background: #5da042; padding: 15px; color: white; border-radius: 15px 15px 0 0; font-weight: bold;">
        AI Messenger
        <span onclick="toggleChat()" style="float: right; cursor: pointer;">âœ–</span>
    </div>
    <div id="chat-messages" style="flex: 1; padding: 15px; overflow-y: auto; font-size: 0.9rem;">
        <div style="margin-bottom: 10px; color: #666;">How can I help you today?</div>
    </div>
    <div style="padding: 10px; border-top: 1px solid #eee; display: flex;">
        <input type="text" id="chat-input" placeholder="Ask anything..." style="flex: 1; border: none; outline: none;">
        <button onclick="sendMessage()" style="background: none; border: none; color: #5da042; font-weight: bold;">Send</button>
    </div>
</div>
<!-- Inside templates/base.html, at the bottom -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function toggleChat() {
        var chat = document.getElementById('chat-window');
        if (chat.style.display === 'none' || chat.style.display === '') {
            chat.style.display = 'flex';
            document.getElementById('chat-input').focus(); // Focus input when opened
        } else {
            chat.style.display = 'none';
        }
    }

    // LISTENER FOR ENTER KEY
    document.getElementById('chat-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    function sendMessage() {
        var input = document.getElementById('chat-input');
        var message = input.value;
        if (!message) return;

        var chatBox = document.getElementById('chat-messages');
        
        // Add User Message
        chatBox.innerHTML += `<div style="text-align: right; margin-bottom: 10px;"><span style="background: #e3fafc; padding: 8px 12px; border-radius: 15px; display: inline-block;">${message}</span></div>`;
        input.value = '';
        chatBox.scrollTop = chatBox.scrollHeight; // Scroll to bottom

        // Call API
        fetch('/api/chat/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({message: message})
        })
        .then(response => response.json())
        .then(data => {
            chatBox.innerHTML += `<div style="text-align: left; margin-bottom: 10px;"><span style="background: #f0f4f8; padding: 8px 12px; border-radius: 15px; display: inline-block;">ðŸ¤– ${data.reply}</span></div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        });
    }
</script>
</body>
</html>